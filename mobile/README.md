# KBP Journal Mobile App

Мобильное приложение для просмотра электронного журнала и расписания.

## Требования

- Node.js 18+
- Expo CLI
- Локальный сервер Next.js должен быть запущен на `localhost:3000`

## Установка

1. Установите зависимости:
```bash
npm install
```

2. Настройте переменные окружения:
Создайте файл `.env` в корне проекта `mobile/`:
```
# Для эмулятора/симулятора
EXPO_PUBLIC_API_URL=http://localhost:3000

# Для реального устройства Android (замените на IP вашего компьютера)
# EXPO_PUBLIC_API_URL=http://192.168.1.XXX:3000

# Для Android эмулятора
# EXPO_PUBLIC_API_URL=http://10.0.2.2:3000

# Для iOS симулятора
# EXPO_PUBLIC_API_URL=http://localhost:3000
```

3. **ВАЖНО**: Запустите локальный сервер Next.js:
```bash
# В корне проекта (не в папке mobile)
cd ..
npm run dev
```

Сервер должен быть доступен на `http://localhost:3000`

## Запуск

### iOS
```bash
npm run ios
```

### Android
```bash
npm run android
```

### Web (для тестирования)
```bash
npm run web
```

## Настройка для реального устройства

Если вы тестируете на реальном устройстве (не эмуляторе):

1. Узнайте IP адрес вашего компьютера:
   - Windows: `ipconfig` (ищите IPv4 адрес)
   - Mac/Linux: `ifconfig` или `ip addr`

2. Обновите `.env` файл:
   ```
   EXPO_PUBLIC_API_URL=http://192.168.1.XXX:3000
   ```

3. Убедитесь, что компьютер и устройство в одной Wi-Fi сети

4. Убедитесь, что брандмауэр разрешает подключения на порт 3000

## Структура проекта

- `App.tsx` - Главный файл с навигацией
- `screens/` - Экраны приложения
  - `LoginScreen.tsx` - Экран входа
  - `DashboardScreen.tsx` - Экран дашборда с журналом и расписанием
- `components/` - Переиспользуемые компоненты
  - `CustomSelect.tsx` - Кастомный селект для выбора группы
  - `JournalTable.tsx` - Таблица журнала
  - `TimetableView.tsx` - Вид расписания
- `services/` - API клиент
  - `api.ts` - Функции для работы с API (через localhost:3000)
- `utils/` - Утилиты
  - `storage.ts` - Работа с AsyncStorage

## Особенности

- Автоматический вход при наличии сохраненных данных
- Кэширование данных журнала, расписания и списка групп
- Горизонтальная прокрутка для таблиц
- Поддержка уведомлений через Telegram бота
- Адаптивный дизайн для разных размеров экранов
- Работает без интернета (использует кэш)

## Решение проблем

### Ошибка "ERR_CONNECTION_REFUSED"
- Убедитесь, что локальный сервер Next.js запущен на `localhost:3000`
- Проверьте настройки `EXPO_PUBLIC_API_URL` в `.env`

### Не загружаются группы
- Проверьте подключение к интернету
- Убедитесь, что сервер Next.js запущен
- Проверьте, что API endpoint `/api/groups` работает (откройте в браузере `http://localhost:3000/api/groups`)

